<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" [
    <!ENTITY types SYSTEM "classpath://your/domain/types.xml">
]>

<hibernate-mapping package="org.iplantc.treedata.model">

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="actionType">
        <param name="enumClassname">org.iplantc.provenance.type.ActionType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="eventType">
        <param name="enumClassname">org.iplantc.provenance.type.EventType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="locationType">
        <param name="enumClassname">org.iplantc.provenance.type.LocationType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="roleType">
        <param name="enumClassname">org.iplantc.provenance.type.RoleType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="locationChildType">
        <param name="enumClassname">org.iplantc.provenance.type.LocationChildType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="deviceType">
        <param name="enumClassname">org.iplantc.provenance.type.DeviceType</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="jobStateType">
        <param name="enumClassname">org.iplantc.jobs.model.JobState</param>
    </typedef>

    <typedef class="org.iplantc.iptol.server.StringEnumUserType" name="contrastJobStatus">
        <param name="enumClassname">org.iplantc.runcontrast.JobStatus</param>
    </typedef>

	<class name="org.iplantc.runcontrast.ContrastJobJsonConfiguration" table="contrast_job">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

		<property name="configuration" />
		<property name="name" not-null="true" />
	 	<property name="username" not-null="true" />
		<property name="created" not-null="true" />
        <property name="status" type="contrastJobStatus" not-null="true" />
		<many-to-one name="workspace" class="Workspace" column="workspace_id" />
	</class>

	<class name="File" table="file">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

        <property name="versionNumber" column="version_number" />
		<property name="name" />
		<property name="uploaded" type="timestamp" />

		<many-to-one name="type" class="FileType" column="type" lazy="false" />

		<many-to-one name="taxa" class="Taxa" column="taxa_id" unique="true" cascade="delete" />

		<set name="trees" table="file_tree" cascade="delete, delete-orphan">
			<key column="file_id"/>
			<many-to-many column="tree_id" class="Tree"/>
		</set>

        <set name="matrices" table="file_matrix" cascade="delete, delete-orphan">
            <key column="file_id"/>
            <many-to-many column="matrix_id" class="Matrix"/>
        </set>

		<list name="blocks" table="block" cascade="delete, delete-orphan">
			<key column="file" />
			<list-index column="parent_order" />
			<one-to-many class="Block" />
		</list>

		<join table="folder_file"
              inverse="true"
              optional="true">
              <key column="file_id"/>
              <many-to-one name="parentFolder"
                           column="folder_id"
                           not-null="true"/>
        </join>
	</class>

	<class name="FileType" table="file_type">
		<id name="id" column="id" />

		<property name="description" />
	</class>

	<class name="Block" table="block">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

		<many-to-one name="type" class="BlockType" column="type" lazy="false" />
		<many-to-one name="file" class="File" column="file" />
		<!-- <property name="order" /> -->
		<property name="unknownType" column="unknown_type" />
		<property name="content" />

		<set name="graphs" table="block_graph">
			<key column="block_id"/>
			<many-to-many column="graph_id"
				class="Graph"/>
		</set>

		<list name="statements" table="statement" cascade="delete, delete-orphan">
			<key column="block" />
			<list-index column="parent_order" />
			<one-to-many class="Statement" />
		</list>

	</class>

	<class name="BlockType" table="block_type">
		<id name="id" column="id" />

		<property name="description" />
	</class>

	<class name="Statement" table="statement">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

		<many-to-one name="type" class="StatementType" column="type" lazy="false" />
		<many-to-one name="block" class="Block" column="block" />
		<!-- <property name="order" /> -->
		<property name="content" />

		<set name="graphs" table="statement_graph">
			<key column="statement_id"/>
			<many-to-many column="graph_id"
				class="Graph"/>
		</set>
	</class>

	<class name="StatementType" table="statement_type">
		<id name="id" column="id" />

		<property name="description" />
	</class>

	<class name="Graph" table="graph">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

        <discriminator column="discriminator" type="string" length="10" />

        <property name="label" length="512" />

		<many-to-one name="root" class="Thing" column="root_thing_id" />
		<many-to-one name="file" class="File" column="file_id" />

        <set name="things" table="graph_thing" cascade="delete, delete-orphan">
            <key column="graph_id"/>
            <many-to-many column="thing_id" class="Thing"/>
        </set>

        <set name="triples" table="graph_triple" cascade="delete, delete-orphan">
            <key column="graph_id"/>
            <many-to-many column="triple_id" class="Triple"/>
        </set>

        <subclass name="Taxa" discriminator-value="Taxa" />
        <subclass name="Tree" discriminator-value="Tree" />
        <subclass name="Matrix" discriminator-value="Matrix" />
	</class>


    <class name="ThingTypeCode" table="thing_type_code">
        <id name="id" column="id" />
        <property name="description" />
    </class>

    <class name="Thing" table="thing">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="name" />
        <many-to-one name="typeCode" column="type" class="ThingTypeCode" />
    </class>

	<class name="Triple" table="triple">
	    <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <many-to-one name="subject" class="Thing" />
        <many-to-one name="object" class="Thing" />
        <property name="double" />
        <property name="string" />
        <many-to-one name="predicate" class="Predicate" />
    </class>

	<class name="Predicate" table="predicate_lookup">
		<id name="id" column="id" />

		<property name="description" />
	</class>



	<class name="Folder" table="folder">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

		<property name="label" />

		<set name="subfolders" table="folder_folder">
			<key column="parent_folder_id"/>
			<many-to-many column="child_folder_id" class="Folder" />
		</set>

		<set name="files" table="folder_file">
			<key column="folder_id"/>
			<many-to-many column="file_id" class="File" />
		</set>

		<join table="folder_folder"
              inverse="true"
              optional="true">
              <key column="child_folder_id"/>
              <many-to-one name="parentFolder"
                           column="parent_folder_id"
                           not-null="false"/>
        </join>

	</class>

	<class name="Workspace" table="workspace">
		<id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
            	<param name="name">mo_id_generator</param>
            	<param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
		</id>

        <property name="userId" column="user_id" />

		<many-to-one name="homeFolder" class="Folder" column="home_folder" unique="true" />
		<many-to-one name="uploadFolder" class="Folder" column="upload_folder" unique="true" />
	</class>

	<!-- Provenance Mappings -->

    <class name="org.iplantc.provenance.model.ProvenanceAction" table="provenance_action">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="actionType" column="action_type" type="actionType" not-null="true" />
        <property name="description" />
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceDevice" table="provenance_device">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="deviceType" column="device_type" type="deviceType" not-null="true" />
        <property name="name" />
        <property name="version" column="device_version" />
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceJob" table="provenance_job">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <many-to-one name="device" class="org.iplantc.provenance.model.ProvenanceDevice" column="device_id" lazy="false" />

        <set name="parameters" cascade="all, delete-orphan" lazy="false">
            <key column="job_id" not-null="true" />
            <one-to-many class="org.iplantc.provenance.model.ProvenanceParam"/>
        </set>
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceParam" table="provenance_param">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="name" not-null="true" />
        <property name="value" not-null="true" />
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceEvent" table="provenance_event">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="startTime" column="start_time" type="timestamp" />
        <property name="endTime" column="end_time" type="timestamp" />

        <property name="eventType" column="event_type" type="eventType" not-null="true" />

        <property name="reason" />

        <many-to-one name="action" class="org.iplantc.provenance.model.ProvenanceAction" column="action_id" cascade="all" unique="true" lazy="false" />
        <many-to-one name="job" class="org.iplantc.provenance.model.ProvenanceJob" column="job_id" cascade="all" unique="true" lazy="false" />

        <set name="locations" cascade="all, delete-orphan" lazy="false" inverse="true">
            <key column="event_id" />
            <one-to-many class="org.iplantc.provenance.model.ProvenanceLocation"/>
        </set>

        <set name="agentRoles" cascade="all, delete-orphan" lazy="false">
            <key column="event_id" not-null="true" />
            <one-to-many class="org.iplantc.provenance.model.ProvenanceAgentRole"/>
        </set>

        <list name="provenance" table="provenance">
            <key column="event_id" />
            <list-index column="index" />
            <element type="string" column="text" />
        </list>
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceLocation" table="provenance_location">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="fileId" column="file_id" />
        <many-to-one name="event" column="event_id" not-null="true" />
        <property name="fileVersion" column="file_version" />
        <property name="fileName" column="file_name" />
        <property name="locationType" column="location_type" type="locationType" not-null="true" />
        <property name="pathName" column="path_name" />
        <property name="childId" column="child_id" />
        <property name="childType" column="child_type" type="locationChildType" />
        <property name="childName" column="child_name" />
    </class>

    <class name="org.iplantc.provenance.model.ProvenanceAgentRole" table="provenance_agent_role">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="username" />
        <property name="roleType" column="role_type" type="roleType" />
    </class>

    <!--  Jobs Mappings -->
    <class name="org.iplantc.jobs.model.Job" table="jobs">
        <id name="id" column="id">
            <generator class="org.iplantc.hibernate.id.SharedSequenceStyleGenerator">
                <param name="name">mo_id_generator</param>
                <param name="force_table_use">true</param>
                <param name="optimizer">pooled</param>
                <param name="initial_value">256</param>
                <param name="increment_size">256</param>
            </generator>
        </id>

        <property name="userId" column="user_id" not-null="true" />
        <property name="name" />
        <property name="description" />
        <property name="state" type="jobStateType" not-null="true" />
        <property name="submitTime" column="submit_time" type="timestamp" not-null="true" />
        <property name="startTime" column="start_time" type="timestamp" />
        <property name="endTime" column="end_time" type="timestamp" />
    </class>

</hibernate-mapping>
